from skimage.morphology import disk
from skimage.exposure import rescale_intensity

def apply_tophat(image, radius):
    structuring_element = disk(radius)
    tophat = cv2.morphologyEx(image, cv2.MORPH_TOPHAT, structuring_element)
    return tophat

def automatic_threshold(image):
    _, thresholded = cv2.threshold(image, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)
    return thresholded

i12_path = '/content/I12.bmp'

i12_image = cv2.imread(i12_path, cv2.IMREAD_GRAYSCALE)
tophat_image = apply_tophat(i12_image, radius=40)
thresholded_image = automatic_threshold(tophat_image)


try:
    fig, axes = plt.subplots(1, 3, figsize=(15, 5))

    axes[0].imshow(i12_image, cmap='gray')
    axes[0].set_title("Original I12 Image")
    axes[0].axis('off')

    axes[1].imshow(tophat_image, cmap='gray')
    axes[1].set_title("Top-hat Transformation")
    axes[1].axis('off')

    axes[2].imshow(thresholded_image, cmap='gray')
    axes[2].set_title("Thresholded Image")
    axes[2].axis('off')

    plt.tight_layout()
    plt.show()

except NameError as e:
    print("Error:", e)
    print("Ensure all preprocessing steps have been correctly executed.")


